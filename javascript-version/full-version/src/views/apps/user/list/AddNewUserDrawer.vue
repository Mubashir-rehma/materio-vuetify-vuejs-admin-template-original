<script setup>
import {
  emailValidator,
  requiredValidator
} from '@validators'

const props = defineProps({
  isDrawerOpen: {
    type: Boolean,
    required: true
  }
})

const emit = defineEmits([
  'update:isDrawerOpen',
  'userData'
])

const isFormValid = ref(false)
const refForm = ref()
const fullName = ref('')
const userName = ref('')
const email = ref('')
const company = ref('')
const country = ref('')
const contact = ref('')
const role = ref()
const plan = ref()
const status = ref()

// ðŸ‘‰ drawer close
const closeNavigationDrawer = () => {
  emit('update:isDrawerOpen', false)
  nextTick(() => {
    refForm.value?.reset()
    refForm.value?.resetValidation()
  })
}
const onSubmit = () => {
  refForm.value?.validate().then(({valid}) => {
    if (valid) {
      emit('userData', {
        id: 0,
        fullName: fullName.value,
        company: company.value,
        role: role.value,
        username: userName.value,
        country: country.value,
        contact: contact.value,
        email: email.value,
        currentPlan: plan.value,
        status: status.value,
        avatar: ''
      })
      emit('update:isDrawerOpen', false)
      nextTick(() => {
        refForm.value?.reset()
        refForm.value?.resetValidation()
      })
    }
  })
}
</script>

<template>
  <VNavigationDrawer
    temporary
    :width="400"
    location="end"
    :model-value="props.isDrawerOpen"
    @update:model-value="(val) => $emit('update:isDrawerOpen', val)"
  >
    <VCard flat>
      <!-- ðŸ‘‰ Title -->
      <VCardTitle class="d-flex align-center bg-var-theme-background py-3">
        <span>Add User</span>

        <VSpacer />

        <!-- ðŸ‘‰ Close btn -->
        <VBtn
          variant="text"
          size="x-small"
          color="default"
          icon
          @click="closeNavigationDrawer"
        >
          <VIcon
            size="20"
            icon="mdi-close"
          />
        </VBtn>
      </VCardTitle>

      <VCardText class="pt-5">
        <!-- ðŸ‘‰ Form -->
        <VForm
          ref="refForm"
          v-model="isFormValid"
          @submit.prevent="onSubmit"
        >
          <VRow>
            <!-- ðŸ‘‰ Full name -->
            <VCol cols="12">
              <VTextField
                v-model="fullName"
                :rules="[requiredValidator]"
                label="Full Name"
              />
            </VCol>

            <!-- ðŸ‘‰ Username -->
            <VCol cols="12">
              <VTextField
                v-model="userName"
                :rules="[requiredValidator]"
                label="Username"
              />
            </VCol>

            <!-- ðŸ‘‰ Email -->
            <VCol cols="12">
              <VTextField
                v-model="email"
                :rules="[requiredValidator, emailValidator]"
                label="Email"
              />
            </VCol>

            <!-- ðŸ‘‰ company -->
            <VCol cols="12">
              <VTextField
                v-model="company"
                :rules="[requiredValidator]"
                label="Company"
              />
            </VCol>

            <!-- ðŸ‘‰ Country -->
            <VCol cols="12">
              <VTextField
                v-model="country"
                :rules="[requiredValidator]"
                label="Country"
              />
            </VCol>

            <!-- ðŸ‘‰ Contact -->
            <VCol cols="12">
              <VTextField
                v-model="contact"
                type="number"
                :rules="[requiredValidator]"
                label="Contact"
              />
            </VCol>

            <!-- ðŸ‘‰ Role -->
            <VCol cols="12">
              <VSelect
                v-model="role"
                label="Select Role"
                :rules="[requiredValidator]"
                :items="['Admin', 'Author', 'Editor', 'Maintainer', 'Subscriber']"
              />
            </VCol>

            <!-- ðŸ‘‰ Plan -->
            <VCol cols="12">
              <VSelect
                v-model="plan"
                label="Select Plan"
                :rules="[requiredValidator]"
                :items="['Basic', 'Company', 'Enterprise', 'Team']"
              />
            </VCol>

            <!-- ðŸ‘‰ Status -->
            <VCol cols="12">
              <VSelect
                v-model="status"
                label="Select Status"
                :rules="[requiredValidator]"
                :items="[{ title: 'Active', value: 'active' }, { title: 'Inactive', value: 'inactive' }, { title: 'Pending', value: 'pending' }]"
              />
            </VCol>

            <!-- ðŸ‘‰ Submit and Cancel -->
            <VCol cols="12">
              <VBtn
                type="submit"
                class="me-3"
              >
                Submit
              </VBtn>
              <VBtn
                type="reset"
                variant="tonal"
                color="secondary"
                @click="closeNavigationDrawer"
              >
                Cancel
              </VBtn>
            </VCol>
          </VRow>
        </VForm>
      </VCardText>
    </VCard>
  </VNavigationDrawer>
</template>
